include_rules

export PKG_CONFIG_PATH

# CXXFLAGS=-O3 -DNDEBUG -Wall -Werror -DHAVE_EXECINFO_H `pkg-config --cflags libxxhash` -pthread
CXXFLAGS=-Wall -Werror -DHAVE_EXECINFO_H -I$(TUP_VARIANTDIR) -pthread -std=c++17 -DHAVE_INT128
LDFLAGS=-pthread
LDLIBS=

CXXFLAGS += -DK=@(K) -DALPHA=@(ALPHA) -std=c++17

# Common
COMMON_SRCS = backtrace.cc common.cc sequence.cc
: foreach $(COMMON_SRCS) |> !cxx |> {common_objs}
: {common_objs} |> !ar |> common.ar

PROGS = traverse_comp greedy_mds mdss2dot comp2rankdot
PROGS += fms2mds optimize_rem_path_len mykkeltveit_set find_longest_path
PROGS += champarnaud_set sketch_components syncmer_set syncmer_sketch frac_set
PROGS += create_seed sketch_histo old_champarnaud_set
run ./rules.sh $(PROGS)

# MDS ilp
ifdef ILP_PYTHON
: MDS-ILP.py |> echo '#!/bin/bash\nTQDM_DISABLE=1 exec "@(ILP_PYTHON)"' "`realpath %f`" @(ALPHA) @(K) "\$((2*@(K)*@(K)*@(K)))" '"$@"' > %o; chmod a+rx %o |> ilp_set
endif
